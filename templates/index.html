<html>
    <head>
        <title>Minimal websocket application</title>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="//code.createjs.com/createjs-2015.11.26.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>
        <script type="text/javascript">
            var app = app || {};

            app.assetsLoaded = false;
            app.baseSprites = {};
            app.config = {{ !APP_SETTINGS }};
        </script>
        <script type="text/javascript">
            (function () {
                var queue, ss, s;
                
                queue = new createjs.LoadQueue(true);
                queue.setMaxConnections(20);
                queue.installPlugin(createjs.Sound);
                queue.on("fileload", onPreloadFile, this);
                // queue.on("progress", onLoadProgress, this);
                queue.on("complete", onPreloadComplete, this);
                queue.loadManifest('manifest.json');

                function onPreloadFile(evt) {
                    switch (evt.item.type) {
                        case createjs.AbstractLoader.SPRITESHEET:
                            ss = evt.result;
                            s = new createjs.Sprite(ss);

                            /* simlink */
                            s.width = ss._frameWidth;
                            s.height = ss._frameHeight;

                            app.baseSprites[evt.item.id] = s;
                            break;
                        case createjs.AbstractLoader.SOUND:
                            break;
                    }
                }

                function onPreloadComplete(evt) {
                    var data = JSON.stringify({
                        msg_type: 'register_user',
                        data: {}
                    })
                    app.ws.send(data);
                    app.assetsLoaded = true;
                    createjs.Sound.muted = false;
                }
                delete queue, ss, s;
            })();
        </script>
        <style type="text/css">
            #gameBoard {
/*                position:fixed;
                left:0;
                top:0;
                width:100%;
                height:100%;*/
            }
        </style>
    </head>
    <body>
        <div id="conn_status">Not Connected</div>
        <div class="container">
            <canvas id="gameBoard" style="border:1px solid #d3d3d3; float: left">Your browser does not support the HTML5 canvas tag.</canvas>
            <canvas id="gameHUD" style="border:1px solid #d3d3d3; float: left">Your browser does not support the HTML5 canvas tag.</canvas>
        </div>

        <script type="text/javascript" src="{{ STATIC_URL }}src/helpers.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/app.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/models/users.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/views/hud.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/views/weaponVision.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/views/sprites.js?updated={{ FILE_VERSION }}"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}src/views/gameOver.js?updated={{ FILE_VERSION }}"></script>
    </body>
</html>